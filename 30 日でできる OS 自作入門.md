# 30 日でできる OS 自作入門

## 目的
登場する概念や道具を整理して、自分の道具として使えるようにする
0から生み出すより、自分の道具箱から使えそうなものを取り出して、変形させる
前提になっているものを整理する

## メモ
何かを覚えることは何かを覚えないこと
手順化
依存関係を整理する
メタ認知する
今何をしているか
何かをするとはどういうことか
何を保証するのか
プログラムの前に、メモリ、データの表現、操作をイメージする
まずは簡単な方法で実装して、問題点があればその改善案を複数検討する
自分が OS の役割を果たす気持ちを持つ

## 0日目 開発を始める前に

イメージファイル: ディスクのバックアップデータ

## 1日目 PCの仕組みからアセンブラ入門まで

数値、音波、文字列、ゲームのデータ、プログラム、を符号化してビットパターンにすることで CPU で処理をしている
符号化の方法はいろいろある
データだけじゃなくて、命令もビットパターンで表現できる
アセンブラを書くときに意識すること
メモリにデータを保存する
データ転送処理がメイン
ブートセクタに IPL が保存されていて、IPL がディスクにある OS をメモリにロードする

## 2日目 アセンブラ学習と Makefile 入門

計算機の構成(今だけ)
CPU(レジスタ)
メモリ(一次記憶装置、二次記憶装置)
基本命令
MOV
JMP
算術演算命令(ADD)
If 文の実現 if (AL == 0) {goto fin;}
CMP AL, 0 	// AL と0を比較しなさい
JE fin 		// 等しい場合 fin にジャンプしなさい
INT 割り込み命令(今は関数呼び出しの一種だと思う)
PC の ROM に BIOS という関数の集まりが定義されていて、INT 番号 で BIOS の指定された番号の処理が呼び出される
その他
ラベル(アドレスのこと)
データの指定方法
レジスタを指定するとレジスタの値を扱う
アドレスに、[] をつけると、アドレスに保存されている値を扱う
即値

## 3日目 32ビットモード突入と C 言語導入

ディスクからメモリにデータを移動する
ディスクアクセス
シリンダ、ヘッド、セクタ、操作の種類、処理するセクタ数、バッファアドレスを指定
80シリンダ x 2ヘッド x 18セクタ x 1セクタ512バイト = 1,440KB

VRAM は画面の画素と対応している
Makefile はソースコードの依存関係を記述している

## 4日目 C 言語と画面表示の練習

画面に何かを書き込みたい
色番号の設定
8ビットだと0〜255までの指定しかできないので、範囲からほしい16個を選んで使えるように設定する
// x0 から x1, y0 から y1 までの範囲に色情報を設定する
void boxfill8(unsigned char *vram, int xsize, unsigned char c, int x0, int y0, int x1, int y1)

## 5日目 構造体と文字表示と GDT/IDT 初期化

文字を出力する

1文字を16バイトで表現する
フォントデータを導入する
A を 0と1で表現して、1バイトずつ16進数で表現し、配列に16個入れる
C 言語では ‘A’ と書くと 0x41 として扱う
_hankaku:
	DB フォントデータ 4096バイト (16バイト * 256文字)
hankaku + ‘A’ * 16 で、A のフォントデータの先頭のアドレスにアクセスする
フォントデータを用意して、文字出力関数に出力したい文字のアドレスを渡す

セグメンテーション
4GBあるメモリを好きなように切り分けて、それぞれのブロックの先頭を0番地として扱える機能
gdt は構造体を並べたもの
最後に gdt のアドレスを GDTR にセットする

## 6日目 分割コンパイルと割り込み処理

PIC初期化
PICは8個の割り込み信号を1つにまとめる装置
PICマスタに IRQ0 - 7 がついていて、IRQ2 に PICスレーブがついていて、PIC スレーブに IRQ8 - 15 がついている

割り込みに対して番号をつける INT xx
Idt に割り込み番号に対して、割り込みハンドラを登録する
割り込みハンドラが所属するセグメントも登録する

## 7日目 FIFO とマウス制御

キーコードの取得

FIFO バッファを作る
サイズを固定したくないのでバッファの先頭アドレスとサイズを構造体で持つ

## 8日目 マウス制御と32ビットモード切り替え

マウスからのデータを受け取って、マウスがどのように動いたのかを解読して、マウスを動かす
マウスの座標に、解読した移動量を加える

32ビットモードへ
コードを参照

## 9日目 メモリ管理

メモリ管理の基本は、確保、割当、開放

## 10日目 重ね合わせ処理





